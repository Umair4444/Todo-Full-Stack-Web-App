# Data Model: FastAPI Todo Backend

## Overview
This document defines the data models for the todo application backend using SQLModel as the ORM.

## Entity: TodoItem

### Attributes
- **id** (Integer, Primary Key, Auto-increment)
  - Unique identifier for each todo item
  - Auto-generated by the database
- **title** (String, Required, Max length: 255)
  - Title of the todo item
  - Cannot be empty
- **description** (String, Optional, Max length: 1000)
  - Detailed description of the todo item
  - Can be null or empty
- **is_completed** (Boolean, Default: False)
  - Status of the todo item (completed/incomplete)
  - Defaults to False when creating a new item
- **created_at** (DateTime, Auto-generated)
  - Timestamp when the todo item was created
  - Automatically set when the record is created
- **updated_at** (DateTime, Auto-generated)
  - Timestamp when the todo item was last updated
  - Automatically updated when the record is modified

### Relationships
- No relationships defined (standalone entity)

### Validation Rules
- Title must not be empty or whitespace only
- Title must be less than 256 characters
- Description must be less than 1001 characters (if provided)
- is_completed must be a boolean value

### SQLModel Definition
```python
from sqlmodel import SQLModel, Field
from datetime import datetime
from typing import Optional

class TodoItemBase(SQLModel):
    title: str = Field(min_length=1, max_length=255)
    description: Optional[str] = Field(default=None, max_length=1000)
    is_completed: bool = Field(default=False)

class TodoItem(TodoItemBase, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)
    
    # Update updated_at on modification
    def __setattr__(self, name, value):
        if name == 'updated_at':
            # Prevent manual setting of updated_at
            super().__setattr__('updated_at', datetime.utcnow())
        else:
            super().__setattr__(name, value)
            if name in ['title', 'description', 'is_completed']:
                # Update updated_at when any of these fields change
                super().__setattr__('updated_at', datetime.utcnow())
```

## Entity: TodoItemCreate

### Attributes
- **title** (String, Required, Max length: 255)
- **description** (String, Optional, Max length: 1000)
- **is_completed** (Boolean, Optional, Default: False)

### Purpose
- Used for creating new todo items
- Subset of TodoItem attributes without id, created_at, or updated_at

### SQLModel Definition
```python
from sqlmodel import SQLModel
from typing import Optional

class TodoItemCreate(SQLModel):
    title: str
    description: Optional[str] = None
    is_completed: bool = False
```

## Entity: TodoItemUpdate

### Attributes
- **title** (String, Optional, Max length: 255)
- **description** (String, Optional, Max length: 1000)
- **is_completed** (Boolean, Optional)

### Purpose
- Used for updating existing todo items
- All fields are optional to allow partial updates

### SQLModel Definition
```python
from sqlmodel import SQLModel
from typing import Optional

class TodoItemUpdate(SQLModel):
    title: Optional[str] = None
    description: Optional[str] = None
    is_completed: Optional[bool] = None
```

## Entity: TodoItemResponse

### Attributes
- **id** (Integer)
- **title** (String)
- **description** (String, Optional)
- **is_completed** (Boolean)
- **created_at** (DateTime)
- **updated_at** (DateTime)

### Purpose
- Used for API responses
- Complete representation of a todo item with all attributes

### SQLModel Definition
```python
from sqlmodel import SQLModel
from datetime import datetime
from typing import Optional

class TodoItemResponse(SQLModel):
    id: int
    title: str
    description: Optional[str]
    is_completed: bool
    created_at: datetime
    updated_at: datetime
```

## Database Schema

### Table: todo_items
```
id: INTEGER PRIMARY KEY AUTOINCREMENT
title: VARCHAR(255) NOT NULL
description: TEXT
is_completed: BOOLEAN DEFAULT FALSE
created_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP
```

### Indexes
- Primary key index on `id`
- Index on `is_completed` for efficient filtering of completed/incomplete items
- Index on `created_at` for chronological sorting

## State Transitions

### Todo Item Lifecycle
1. **Created**: When a new todo item is added
   - `is_completed` = False
   - `created_at` = current timestamp
   - `updated_at` = current timestamp

2. **Updated**: When any attribute of the todo item changes
   - `updated_at` = current timestamp

3. **Completed**: When the todo item status changes to completed
   - `is_completed` = True
   - `updated_at` = current timestamp

4. **Deleted**: When the todo item is removed
   - Record is removed from the database

## Validation Rules Summary

1. **Title Validation**:
   - Required field
   - Must be 1-255 characters
   - Cannot be empty or whitespace only

2. **Description Validation**:
   - Optional field
   - Maximum 1000 characters if provided

3. **Status Validation**:
   - Boolean value only
   - Defaults to False

4. **Timestamp Validation**:
   - Automatically managed by the system
   - Cannot be manually set by users